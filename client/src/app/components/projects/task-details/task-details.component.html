<app-navbar></app-navbar>

<div class="task-page">
	<ng-container *ngIf="!editing()">
		<div class="title-row">
			<div class="task-title-pill">
				<span class="task-title-text">{{ task()?.title }}</span>
				<span class="task-priority-pill {{task()?.priority}}">{{ task()?.priority || 'LOW' }}</span>
			</div>
			<div class="title-actions">
				<button class="icon-btn task-edit-outside" (click)="startEdit()" aria-label="Edit">âœŽ</button>
				<button class="icon-btn task-delete-outside" (click)="onDeleteClick()" aria-label="Delete">ðŸ—‘</button>
			</div>
		</div>

		<div class="task-card">
			<div class="task-meta">
				<div class="project-pill" (click)="back()">{{ task()?.project?.project_title }}</div>
				<div class="meta-item">ðŸ“… {{ task()?.deadline | date }}</div>
				<div class="meta-item">ðŸ‘¤ {{ task()?.assigned_to?.first_name }}</div>
				<div class="status-select">
					<select [formControl]="stateControl" [ngClass]="statusClass" (change)="changeState($any($event.target).value)">
						<option [disabled]="task()?.state == 'NOT STARTED' || (!isProjectManager() && task()?.state == 'COMPLETED')">NOT STARTED</option>
						<option [disabled]="task()?.state == 'IN PROGRESS' || (!isProjectManager() && task()?.state == 'COMPLETED')">IN PROGRESS</option>
						<option [disabled]="task()?.state == 'SUBMITTED FOR VALIDATION' || (!isProjectManager() && task()?.state == 'COMPLETED')">SUBMITTED FOR VALIDATION</option>
						<option [disabled]="!isProjectManager() || task()?.state == 'COMPLETED'">COMPLETED</option>
					</select>
				</div>
			</div>

			<div class="section">
				<div class="section-title">Task Description</div>
				<div class="section-body">{{ task()?.description }}</div>
			</div>
		</div>
	</ng-container>

	<ng-container *ngIf="editing()">
		<app-task-edit [project]="project()" [task]="task()" (update)="onUpdate($event)" (cancel)="onCancelEdit()"></app-task-edit>
	</ng-container>
</div>
