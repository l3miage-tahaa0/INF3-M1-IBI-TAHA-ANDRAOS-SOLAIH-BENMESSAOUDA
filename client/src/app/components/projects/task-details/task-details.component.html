<app-navbar></app-navbar>

<div class="task-page">
	<ng-container *ngIf="!editing()">
		<div class="title-row">
			<div class="task-title-pill">
				<span class="task-title-text">{{ task()?.title }}</span>
				<span class="task-priority-pill {{task()?.priority}}">{{ task()?.priority || 'Low' }}</span>
			</div>
			<div class="title-actions">
				<button class="icon-btn task-edit-outside" (click)="startEdit()" aria-label="Edit">âœ</button>
				<button class="icon-btn task-delete-outside" (click)="onDeleteClick()" aria-label="Delete">ğŸ—‘</button>
			</div>
		</div>

		<div class="task-card">
			<div class="task-meta">
				<div class="project-pill" (click)="back()">{{ task()?.project?.project_title }}</div>
				<div class="meta-item">ğŸ“… {{ task()?.deadline | date }}</div>
				<div class="meta-item">ğŸ‘¤ {{ task()?.assigned_to?.first_name }}</div>
				<div class="status-select">
					<select [formControl]="stateControl" [ngClass]="statusClass" (change)="changeState($any($event.target).value)">
						<option [disabled]="task()?.state == 'Not Started' || (!isProjectManager() && task()?.state == 'Completed')">Not Started</option>
						<option [disabled]="task()?.state == 'In Progress' || (!isProjectManager() && task()?.state == 'Completed')">In Progress</option>
						<option [disabled]="task()?.state == 'Submitted for Validation' || (!isProjectManager() && task()?.state == 'Completed')">Submit for Validation</option>
						<option [disabled]="!isProjectManager() || task()?.state == 'Completed'">Completed</option>
					</select>
				</div>
			</div>

			<div class="section">
				<div class="section-title">Task Description</div>
				<div class="section-body">{{ task()?.description }}</div>
			</div>
		</div>
	</ng-container>

	<ng-container *ngIf="editing()">
		<app-task-edit [project]="project()" [task]="task()" (update)="onUpdate($event)" (cancel)="onCancelEdit()"></app-task-edit>
	</ng-container>
</div>
