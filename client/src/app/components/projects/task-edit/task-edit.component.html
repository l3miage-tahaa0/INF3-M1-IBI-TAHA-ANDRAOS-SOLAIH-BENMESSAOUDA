<div class="task-create-page">
	<div class="task-create-card">
		<div class="task-header">
			<h2>Edit Task</h2>
			<div class="project-pill">{{ project?.title || 'Project' }}</div>
		</div>

		<form [formGroup]="form" class="task-form" (ngSubmit)="save()">
			<div class="row">
				<div class="input-col">
					<div class="input-group">
						<input formControlName="title" placeholder="Task Title" />
					</div>
					<div *ngIf="form.get('title')?.invalid && form.get('title')?.touched" class="error-message">
						<div *ngIf="form.get('title')?.errors?.['required']">Title is required.</div>
						<div *ngIf="form.get('title')?.errors?.['minlength']">Title must be at least 3 characters.</div>
					</div>
				</div>
			</div>

			<div class="row small-gap">
				<div class="input-col">
					<div class="priority-buttons">
						<button type="button" [class.selected]="form.get('priority')?.value==='HIGH'" class="priority high" (click)="form.get('priority')?.setValue('HIGH')">High</button>
						<button type="button" [class.selected]="form.get('priority')?.value==='MEDIUM'" class="priority medium" (click)="form.get('priority')?.setValue('MEDIUM')">Medium</button>
						<button type="button" [class.selected]="form.get('priority')?.value==='LOW'" class="priority low" (click)="form.get('priority')?.setValue('LOW')">Low</button>
					</div>
				</div>
				<div class="input-col">
					<div class="input-group"><input type="date" formControlName="deadline" [min]="minDate" placeholder="Deadline" /></div>
				</div>
			</div>

			<div class="input-group"><textarea rows="6" formControlName="description" placeholder="Task Description"></textarea></div>
			<div *ngIf="form.get('description')?.invalid && form.get('description')?.touched" class="error-message">
				<div *ngIf="form.get('description')?.errors?.['maxlength']">Description is too long.</div>
			</div>

			<div class="input-group small-gap">
				<label style="font-weight:700; color:#2b85e8; margin-bottom:6px; display:block">
					@if(task?.assigned_to){ Assigned to: {{ task?.assigned_to?.first_name }} {{ task?.assigned_to?.last_name }} } @else{ Assigned to: None}
				</label>
				<app-team-dropdown [project]="project" (selection)="onassigned_toSelected($event)"></app-team-dropdown>
			</div>

			<div style="text-align:center">
				<button class="create-btn" type="button" (click)="save()" [disabled]="form.invalid">Save</button>
				<button class="cancel-btn" type="button" (click)="onCancel()">Cancel</button>
			</div>
		</form>
	</div>
</div>
